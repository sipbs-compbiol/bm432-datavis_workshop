---
title: "BM432 Data Visualisation"
author: 
  - name: "Morgan Feeney"
    affiliation: "University of Strathclyde"
  - name: "Leighton Pritchard"
    affiliation: "University of Strathclyde"
date: "2024-10-23"
format: 
  revealjs:
    slide-number: true
    controls: true
    preview-links: auto    
    footer: "BM432 Data Visualisation Workshop"
    logo: images/science_logo_400x400.jpg
    theme: [default, ./includes/custom.scss]
    width: 1280
    height: 720
    self-contained: true
---

```{r setup, include=FALSE}
# Package imports
library(dplyr)
library(ggplot2)
library(ggthemes)
library(googlesheets4)
library(htmltools)
library(knitr)
library(stringr)
library(tidyr)
library(tm)
library(wordcloud)
library(wordcloud2)

# Authenticate with Google Forms
gs4_deauth()

# Grab data and clean it
# dfm = read_sheet("https://docs.google.com/spreadsheets/d/1Qs3Hdeycu9Q8KBqpQ6qlv6NaUW62Al_PPWF96x1lACI/edit?resourcekey=&gid=1498908795#gid=1498908795")
dfm <- read_sheet("https://docs.google.com/spreadsheets/d/1e4i7g-zfEiDmMFZMXMzm4gqddGc7HVBFEDfGeLTeFnM/edit?resourcekey=&gid=12171434#gid=12171434")
# 2025-26 Google Form location
# https://docs.google.com/forms/d/e/1FAIpQLSf2HbFQUkw2Ookp65Q_aLnsEGh3wRS0ZOta6Q7f2s-EFs4V6A/viewform?usp=header
# 2025-26 Google Form response spreadsheet
# https://docs.google.com/spreadsheets/d/1e4i7g-zfEiDmMFZMXMzm4gqddGc7HVBFEDfGeLTeFnM/edit?resourcekey=&gid=12171434#gid=12171434
colnames(dfm) = c("timestamp",
                  "grade_fig1", "explain_fig1", "improvements_fig1", "questions_fig1",
                  "grade_fig2", "explain_fig2", "improvements_fig2", "questions_fig2",
                  "grade_fig3", "explain_fig3", "improvements_fig3", "questions_fig3",
                  "grade_fig4", "explain_fig4", "improvements_fig4", "questions_fig4",
                  "other_comments")

# Ignore responses prior to a given date
dfm = dfm %>% filter(timestamp > "2025-10-01")

# Function to generate Economist-style figures from categories
draw_economist_categories = function(dfm, categories, fig_num) {
  ratings = dfm %>%
    filter(fignum == fig_num) %>%
    pivot_longer(cols=all_of(categories),
                 names_to = "category",
                 values_to = "rating")
  ratings$rating = factor(ratings$rating, levels=c("1", "2", "3", "4", "5"))
  p = ggplot(ratings, aes(x=rating))
  p = p + geom_bar() +
    stat_count(geom="text", color="white", mapping=aes(label=..count..), vjust=2)
  p = p + facet_wrap(~category)
  p = p + theme_economist() + scale_x_discrete(drop=FALSE)
  p
}

# Function to generate Tufte-style figures from categories
draw_tufte_categories = function(dfm, categories, fig_num) {
  ratings = dfm %>%
    filter(fignum == fig_num) %>%
    pivot_longer(cols=all_of(categories),
                 names_to = "category",
                 values_to = "rating")
  p = ggplot(ratings, aes(x=category, y=rating))
  p = p + geom_violin(mapping=aes(fill=category), alpha=0.3, linewidth=0) 
  p = p + geom_point(position=position_jitter(height=0.1, width=0.1), alpha=0.4)
  # p = p + geom_violin(outlier.colour="red") + geom_point(position=position_jitter(height=0.1, width=0.1), alpha=0.35)
  p = p + theme_tufte() + ylim(1, 5) + coord_flip()
  p = p + scale_color_brewer(palette="Dark2")
  p = p + theme(legend.position = "none")
  p
}

# Function to generate hc-style figures from categories
draw_hc_categories = function(dfm, categories) {
  ratings = dfm %>%
    pivot_longer(cols=all_of(categories),
                 names_to = "category",
                 values_to = "rating")
  p = ggplot(ratings, aes(x=fignum, y=rating, color=fignum))
  p = p + geom_violin(mapping=aes(fill=fignum), alpha=0.15, linewidth=0) 
  p = p + geom_point(position=position_jitter(height=0.1, width=0.1), alpha=0.4)
  p = p + facet_wrap(~category, nrow=1)
  p = p + theme_hc() + scale_x_discrete(drop=FALSE) 
  p = p + theme(legend.position = "none")
  p = p + scale_color_brewer(palette="Dark2")
  p = p + scale_fill_brewer(palette="Dark2")
  p
}

# Process character column into a wordcloud
process_words = function(dfrm) {
  corpus = Corpus(VectorSource(dfrm[,1]))
  comments = corpus %>%
    tm_map(removeNumbers) %>%
    tm_map(removePunctuation) %>%
    tm_map(stripWhitespace) %>%
    tm_map(content_transformer(tolower)) %>%
    tm_map(removeWords, stopwords("english")) %>%
    tm_map(removeWords, c("figure", "make", "figures", "graph", "graphs",
                          "perhaps", "including", "sure", "instead",
                          "first", "middle", "could", "couldve", "may",
                          "makes", "use", "also", "can", "much", "made",
                          "many", "shows", "mutant", "dont", "still", "isnt",
                          "whats", "via", "allow", "bit", "just", "drug",
                          "cell", "gcase", "try", "although", "cclear",
                          "slightly", "making", "around", "actually",
                          "way", "going", "like", "maybe", "etc", "dmso",
                          "doesnt", "might", "par", "should", "shouldve",
                          "didnt", "will", "data", "easy"))
  wordmat <- as.matrix(TermDocumentMatrix(comments))
  words <- sort(rowSums(wordmat), decreasing=TRUE)
  dfm_words <- data.frame(word = names(words), freq=words)
  dfm_words
}

# Globals

doi_fig1 = "10.1073/pnas.2320257121"
doi_fig2 = "10.1073/pnas.2405474121"
doi_fig3 = "10.1073/pnas.2408540121"
doi_fig4 = "10.1073/pnas.240342112"

# Code block options
# knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
```

# 1. Introduction

## Learning Objectives

- You should be able to critically analyse how data is visualised 
- You should be able to judge a figure's clarity and potential for misunderstanding
- You should be able to identify potential sources of bias resulting from the visualisation
- You should understand how to create effective figures for your own work

## Background Reading

- Introduction to Data Visualisation
  - [https://sipbs-compbiol.github.io/BM432/notebooks/04-data_presentation_workshop.html](https://sipbs-compbiol.github.io/BM432/notebooks/04-data_presentation_workshop.html)
  
- Interactive Data Visualisation examples
  - [https://sipbs-bm432.shinyapps.io/03-04a-barchart/](https://sipbs-bm432.shinyapps.io/03-04a-barchart/)
  
- Additional information:
  - ["Fundamentals of Data Visualisation" _by Claus O. Wilke_](https://clauswilke.com/dataviz/)
  - ["Data Visualisation: A Practical Introduction" _by Kieran Healy_](https://socviz.co/index.html#preface)
  - ["Points of View: graphic design for data visualisation"](git@github.com:sipbs-compbiol/bm432-datavis_workshop.git)
  
## Exercise: Four figures (assess all figures)

- Use the DOIs provided to find the papers the figures are from, if you need more information than is in the figure legend

- **For each figure, consider the following:**
  - What type of data is being presented?
  - Are the data presented effectively? (why/why not?)
  - How might the data presentation be improved?
  - How would you grade this figure according to University Marking Guide B?
- Fill in the _pro forma_ with your scoring and free-text answers to the questions above (one sentence each)
  - [Google Form](https://forms.gle/cyJPnnuvVRazcTkk7)

## Figure 1 (doi:`r doi_fig1`)

<center>
<img src="images/2024_fig_1.jpg" height="500px" />
</center>

## Figure 2 (doi:`r doi_fig2`)

<center>
<img src="images/2024_fig_2.jpg" height="500px" />
</center>

## Figure 3 (doi:`r doi_fig3`)

<center>
<img src="images/2024_fig_3.jpg" width="100%" />
</center>

## Figure 4 (doi:`r doi_fig4`)

<center>
<img src="images/2024_fig_4.jpg" height="500px" />
</center>


# 4. Individual Figures

## Figure 1 (doi:`r doi_fig1`)  {.scrollable}

<center>
<img src="images/2024_fig_1.jpg" />
</center>

## Figure 1 (doi:`r doi_fig1`) <img src="images/2024_fig_1.jpg" height="40px" /> 

:::: { .columns }

::: {.column width="40%"}
<center>
<img src="images/2024_fig_1.jpg" width="450px" />
</center>
:::

::: {.column width="60%" .r-fit-text}
- Suggested improvements:
  - The lower extent of error bars is not visible in (B), (D), (G), or (E). Avoid "dynamite plots."
  - Bar charts should be avoided; 1D scatterplot for (D), (G), and (E) would be clearer. Line plot with concentration on $x$-axis would improve (B).
  - We can't see difference between effects of two concentrations of A16 in (D), or A16 vs A18 in (B); use a table of contrasts.
  - Place things to be compared by the reader next to each other where possible (E).
:::

::::


## Figure 1 (doi:`r doi_fig1`) <img src="images/2024_fig_1.jpg" height="40px" /> {.smaller .scrollable}

```{r fig1_improvements}
dfm %>% select(improvements_fig1) %>%
  filter(!is.na(improvements_fig1)) %>%
  kable(col.names=c("Suggestions for improvement"))
```


## Figure 2 (doi:`r doi_fig2`) {.scrollable}

<center>
<img src="images/2024_fig_2.jpg" />
</center>


## Figure 2 (doi:`r doi_fig2`) <img src="images/2024_fig_2.jpg" height="40px" /> 

:::: { .columns }

::: {.column width="40%"}
<center>
<img src="images/2024_fig_2.jpg" height="450px" />
</center>
:::

::: {.column width="60%" .r-fit-text}
- Suggested improvements:
  - UMAP plots (B, E) are highly manipulable and clustering/placement does not necessarily reflect objective measures.
  - Unpleasant colour choices in (C); there is room for aesthetic improvement.
  - The proportion plot in (C) does not give information on absolute number, only proportion; a proportional areas plot spanning all clusters would more honestly represent the data.
  - Heatmap text is too small to read comfortably; is there too much data here?
:::

::::

## Figure 2 (doi:`r doi_fig2`) <img src="images/2024_fig_2.jpg" height="40px" /> {.smaller .scrollable}

```{r fig2_improvements}
dfm %>% select(improvements_fig2) %>%
  filter(!is.na(improvements_fig2)) %>%  
  kable(col.names=c("Suggestions for improvement"))

```


## Figure 3 (doi:`r doi_fig3`)  {.scrollable}

<center>
<img src="images/2024_fig_3.jpg" />
</center>

## Figure 3 (doi:`r doi_fig3`) <img src="images/2024_fig_3.jpg" height="40px" /> 

:::: { .columns }

::: {.column width="40%"}
<center>
<img src="images/2024_fig_3.jpg" width="100%" />
</center>
:::

::: {.column width="60%" .r-fit-width}
- Suggested improvements:
  - The lower extent of error bars is not visible in (D) or (E). These are "dynamite plots," which should be avoided.
  - Bar charts should be avoided in general; a 1D scatterplot of each dataset in (D) and (E) would be clearer.
:::

::::

## Figure 3 (doi:`r doi_fig3`) <img src="images/2024_fig_3.jpg" height="40px" />

:::: { .columns }

::: {.column width="40%"}
<img src="images/2024_fig_3.jpg" width="100%" />
:::

::: {.column width="60%" .r-fit-width}
- Suggested improvements (MF):
  - Failure to complement the triple mutant strain???
  - Fluorescence wavelength not specified (C)
  - Colour scheme in (A) is inconsistent
  - Axis label in (B) could be improved
  - Figure legend for (A) could be more succinct/some of this info should be in the paper text instead
:::

::::

## Figure 3 (doi:`r doi_fig3`) <img src="images/2024_fig_3.jpg" height="40px" /> {.smaller .scrollable}

```{r fig3_improvements .r-fit-width}
dfm %>% select(improvements_fig3) %>%
  filter(!is.na(improvements_fig3)) %>%  
  kable(col.names=c("Suggestions for improvement"))
```


## Figure 4 (doi:`r doi_fig4`)  {.scrollable}

<center>
<img src="images/2024_fig_4.jpg" />
</center>


## Figure 4 (doi:`r doi_fig4`) <img src="images/2024_fig_4.jpg" height="40px" /> 

:::: { .columns }

::: {.column width="40%"}
<center>
<img src="images/2024_fig_4.jpg" height="450px" />
</center>
:::

::: {.column width="60%" .r-fit-text}
- Suggested improvements:
  - The rifampicin structure is purely decorative and could be removed.
  - The lower extent of error bars is not visible in (B). This is a "dynamite plot," which should be avoided.
  - Bar charts should be avoided in general; a 1D scatterplot of each dataset in (B) would be clearer.
  - The implied membrane in (C) and (D) could be stated as such in the figure.
:::

::::

## Figure 4 (doi:`r doi_fig4`) <img src="images/2024_fig_4.jpg" height="40px" /> {.smaller .scrollable}

```{r fig4_improvements}
dfm %>% select(improvements_fig4) %>%
  filter(!is.na(improvements_fig4)) %>%  
  kable(col.names=c("Suggestions for improvement"))
```

# 5. Summing Up

## General Comments

- Colour choices
- Larger figures/graphs, more space between figures/graphs
- Too much data per figure
- Split into multiple figures
- Remove unnecessary data (how do we define this?)
- “The data is presented in a manner that would likely be inaccessible for people without prior experience. A move toward a more palatable/digestible format will facilitate better science communication in the future.”

## Visualising Data About Data Visualisation

- How did you explain your marks?

<center>
```{r eff_wordcloud}
explain = data.frame(rbind(dfm$explain_fig1, dfm$explain_fig2, dfm$explain_fig3, dfm$explain_fig4))
effwords = process_words(explain)
wordcloud2(data=effwords, size=0.3, color='random-dark')
```
</center>

## Visualising Data About Data Visualisation

- What words did you use to describe ways the figure could be improved?

<center>
```{r imp_wordcloud}
improvements = data.frame(rbind(dfm$improvements_fig1, dfm$improvements_fig2, dfm$improvements_fig3, dfm$improvements_fig4))
impwords = process_words(improvements)
wordcloud(words = impwords$word, freq = impwords$freq,
          min.freq = 1, max.words=200, random.order=FALSE, rot.per=0.35,
          colors=brewer.pal(8, "Dark2"))
```
</center>

## Data Visualisation is Not Neutral  

:::: { .columns }

::: {.column width="50%"}
<center>
<img src="images/bojo1.jpg" width="110%" />
</center>
:::

::: {.column width="50%"}
<center>
<img src="images/bojo2.jpg" width="110%" />
</center>
:::

::::


